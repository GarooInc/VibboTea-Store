
{%- liquid
  assign topbar_height = 0
  if section.settings.show_topbar
    assign topbar_height = 40
  endif
-%}

{% if section.settings.show_topbar %}
<div class="topbar-wrapper blinkBW full-width py-2 cursor-pointer fixed top-0 w-full z-50 font-bricolage">

  <a href="{{ section.settings.topbar_link }}" class="block w-full">
    <div class="topbar-content">
      {% for  i in (1..6) %}
        <div class="topbar-text  text-sm md:text-base font-medium flex justify-center items-center gap-4 px-4 md:py-0 py-1">

          {{ section.settings.topbar_announcement_text }}
          {% if section.settings.isotipe %}
            <img 
              src="{{ section.settings.isotipe | img_url: '200x200' }}" 
              alt="Isotipe"
              class="inline-block h-5 w-5 object-contain"
              width="{{ section.settings.isotipe.width }}"
              height="{{ section.settings.isotipe.height }}"
            >
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </a>
</div>
{% endif %}

<header 
  id="main-header"
  class="fixed left-0 w-full md:h-30 h-20 bg-cover bg-center flex items-center justify-center overflow-hidden z-50"
  style="top: {{ topbar_height }}px;"
>
{%- capture background_class -%}
  {%- if section.settings.header_background == 'transparent' -%}
    bg-transparent
  {%- elsif section.settings.header_background == 'white' -%}
    bg-white
  {%- else -%}
    bg-black/40
  {%- endif -%}
{%- endcapture -%}

{%- capture text_color -%}
  {%- if section.settings.header_background == 'white' -%}
    text-black
  {%- else -%}
    text-white
  {%- endif -%}
{%- endcapture -%}

<div class="justify-between absolute top-0 left-0 w-full md:grid md:grid-cols-3 items-center md:py-[3.5vh] px-0 ml-0 pl-0 z-30 {{ background_class | strip_newlines }}">

  <!-- movil (col 1) -->

    <div class="lg:hidden md:hidden xl:hidden  flex items-center justify-between py-4 w-full px-4 ">
      <div class="flex items-center pl-3">
        {% if section.settings.logo %}
          <a href="{{ routes.root_url }}">
            <img 
              src="{{ section.settings.logo | img_url: '2000x2000' }}" 
              alt="Logo"
              class=" w-23 object-contain"
              width="{{ section.settings.background_image.width }}"
              height="{{ section.settings.background_image.height }}"
            >
          </a>
          
        {% else %}
          <h2 class="text-xl font-bold {{ text_color | strip_newlines }}">
            {{ shop.name }}
          </h2>
        {% endif %}
      </div>
      <!-- Hamburger Menu Button -->
      <button 
        type="button" 
        class="mobile-menu-toggle {{ text_color | strip_newlines }} w-12 h-12 flex flex-col justify-center items-center space-y-1.5"
        aria-label="Toggle menu"
        onclick="toggleMobileMenu()">
        {%-  render 'icon-hamburger' %}
      </button>

     
      
    </div>
      <!-- MOBILE MENU -->
    <div 
        id="mobile-menu" 
        class="lg:hidden hidden fixed inset-0 w-full min-h-screen h-screen bg-black px-8 z-50 pointer-events-auto top-0"
      >
        <div class="flex justify-start gap-2 pt-10 relative z-50 pointer-events-auto">

            
            
            <a href="{{ routes.account_url }}"
              class="footer-icon hover:opacity-70 transition-opacity scale-90 {{ text_color | strip_newlines }} [&_svg]:stroke-current " 
              aria-label="User">
              {%- render 'user' -%}
            </a>
            <a href="{{ routes.cart_url }}"
              class="footer-icon hover:opacity-70 transition-opacity scale-90 {{ text_color | strip_newlines }} [&_svg]:stroke-current " 
              aria-label="Cart">
              {%- render 'iconCart' -%}
            </a>
            <a href="{{ routes.all_products_collection_url }}" 
              class="footer-icon hover:opacity-70 transition-opacity scale-90 {{ text_color | strip_newlines }} [&_svg]:stroke-current " 
              aria-label="Instagram">
              {%- render 'search' -%}
            </a>
        </div>


        <!-- BOTÓN CERRAR -->
        <button 
          type="button"
          aria-label="Close menu"
          onclick="toggleMobileMenu()"
          class="absolute top-10 right-6 z-50 w-12 h-12 flex items-center justify-center text-white text-3xl"
        >
          ✕
        </button>


        <nav class="flex flex-col justify-center items-center h-full -translate-y-15">
          {% for link in section.settings.menu.links %}
            <a 
              href="{{ link.url }}" 
              class="text-2xl tracking-wider text-gray-300 transition-colors duration-200 text-center py-2 font-bricolage"
              onclick="toggleMobileMenu()"
            >
              {{ link.title }}
            </a>
          {% endfor %}
        </nav>

      </div>



      
  <!-- LOGO (col 1) -->
  <div class="hidden md:flex items-center pl-10">
    {% if section.settings.logo %}
      <a href="{{ routes.root_url }}">
        <img 
          src="{{ section.settings.logo | img_url: '2000x2000' }}" 
          alt="Logo"
          class=" w-40 object-contain"
          width="{{ section.settings.background_image.width }}"
          height="{{ section.settings.background_image.height }}"
        >
      </a>
      
    {% else %}
      <h2 class="text-xl font-bold {{ text_color | strip_newlines }}">
        {{ shop.name }}
      </h2>
    {% endif %}
  </div>

  <!-- MENU desktop (col 2) -->
  <nav class="hidden md:flex  md:justify-center space-x-8">
    {% for link in section.settings.menu.links %}
      <a 
        href="{{ link.url }}" 
        class="font-light font-bricolage text-lg md:text-xl lg:text-lg xl:text-xl p-4 tracking-wider
         uppercase {{ text_color | strip_newlines }} hover:font-bold transition-colors duration-200 whitespace-nowrap"
      >
        {{ link.title }}
      </a>
    {% endfor %}
  </nav>

  <!-- Col 3  -->
  <div>
      <div class="hidden md:flex justify-end md:pr-7 md:gap-2">
            <button
              type="button"
              id="openSearch"
              class="footer-icon hover:opacity-70 transition-opacity scale-90 {{ text_color | strip_newlines }} [&_svg]:stroke-current"
              aria-label="Search"
            >
              {%- render 'search' -%}
            </button>

            <a href="{{ routes.cart_url }}"
              class="footer-icon hover:opacity-70 transition-opacity scale-90 {{ text_color | strip_newlines }} [&_svg]:stroke-current " 
              aria-label="Cart">
              {%- render 'iconCart' -%}
            </a>
            <a href="{{ routes.account_url }}"
              class="footer-icon hover:opacity-70 transition-opacity scale-90 {{ text_color | strip_newlines }} [&_svg]:stroke-current " 
              aria-label="User">
              {%- render 'user' -%}
            </a>
        </div>
        
  </div>

</div>

 
</header>



<div
  id="searchOverlay"
  class="fixed inset-0 bg-black/40 backdrop-blur-sm z-999 hidden"
>
  <div class="absolute top-20 left-1/2 -translate-x-1/2 w-full max-w-xl px-4">
    
    <predictive-search class="relative block">
      <form action="{{ routes.search_url }}" method="get" role="search">
        <input
          type="search"
          name="q"
          placeholder="Search products"
          autocomplete="off"
          autofocus
          class="w-full h-14 px-6 text-lg outline-none bg-white "
        >
      </form>

      <div
        data-predictive-search-results
        class="absolute mt-3 w-full bg-white hidden"
      ></div>
    </predictive-search>

  </div>
</div>




<script>
  function toggleMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const header = document.getElementById('main-header');
    menu.classList.toggle('hidden');
    header.classList.toggle('h-screen');
    document.body.classList.toggle('overflow-hidden');
  }
</script>
<script>
  const openBtn = document.getElementById('openSearch');
  const overlay = document.getElementById('searchOverlay');
  const input = overlay?.querySelector('input');

  function openSearch() {
    overlay.classList.remove('hidden');
    document.body.classList.add('overflow-hidden');
    input?.focus();
  }

  function closeSearch() {
    overlay.classList.add('hidden');
    document.body.classList.remove('overflow-hidden');
    input.value = '';
  }

  openBtn?.addEventListener('click', openSearch);

  overlay?.addEventListener('click', e => {
    if (e.target === overlay) {
      closeSearch();
    }
  });

  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
      closeSearch();
    }
  });
</script>


<script>
  class PredictiveSearch extends HTMLElement {
    constructor() {
      super();
      this.input = this.querySelector('input');
      this.results = this.querySelector('[data-predictive-search-results]');
      this.input.addEventListener('input', this.onChange.bind(this));
    }

    async onChange() {
      const q = this.input.value.trim();

      if (q.length < 2) {
        this.results.classList.add('hidden');
        return;
      }

      const res = await fetch(
        `/search/suggest.json?q=${encodeURIComponent(q)}&resources[type]=product`
      );

      const data = await res.json();
      const products = data.resources.results.products;

      if (!products || products.length === 0) {
        window.location.href = '/404';
        return;
      }

      this.results.innerHTML = products
        .map(p => `
          <a href="${p.url}" class="block px-5 py-3 hover:bg-gray-100">
            ${p.title}
          </a>
        `)
        .join('');

      this.results.classList.remove('hidden');
    }
  }

  customElements.define('predictive-search', PredictiveSearch);
</script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const topbarContent = document.querySelector('.topbar-content');
    if (topbarContent) {
      const textWidth = topbarContent.querySelector('.topbar-text').offsetWidth;
      const duration = textWidth / 40;
      topbarContent.style.animationDuration = duration + 's';
    }
  });
</script>

{% stylesheet %}
  body {
    overflow-x: hidden;
  }
 
  header a sup {
    position: absolute;
    left: 100%;
    overflow: hidden;
    max-width: var(--page-margin);
  }
  header svg {
    width: 2rem;
  }
  header .header__menu,
  header .header__icons {
    display: flex;
    gap: 1rem;
  }

  .topbar-content {
    display: flex;
    animation: scroll 10s linear infinite;
    white-space: nowrap;
  }
  
  .topbar-text {
    flex-shrink: 0;
  }
  
  @keyframes scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }
  
  .topbar-wrapper:hover .topbar-content {
    animation-play-state: paused;
  }

  
  @keyframes blinkBW {
  0% {
    background-color: #000;
    color: #fff;
  }
  50% {
    background-color: #fff;
    color: #000;
  }
  100% {
    background-color: #000;
    color: #fff;
  }
}

.blinkBW {
  animation: blinkBW 4.0s infinite;
}

{% endstylesheet %}

{% schema %}
{
  "name": "Custom Header",
  "settings": [
    {
      "type": "header",
      "content": "Topbar Settings"
    },
    {
      "type": "checkbox",
      "id": "show_topbar",
      "label": "Show Topbar",
      "default": false
    },
    {
      "type": "image_picker",
      "id": "isotipe",
      "label": "Isotipe Image"
    },
    {
      "type": "richtext",
      "id": "topbar_announcement_text",
      "label": "Announcement Text"
    },
    {
      "type": "url",
      "id": "topbar_link",
      "label": "Topbar Link"
    },
   
    {
      "type": "header",
      "content": "Header Settings"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Image"
    },
    {
      "type": "select",
      "id": "header_background",
      "label": "Header Background",
      "options": [
        {
          "value": "semi-transparent",
          "label": "Semi-transparent Black"
        },
        {
          "value": "transparent",
          "label": "Transparent"
        },
        {
          "value": "white",
          "label": "White"
        }
      ],
      "default": "semi-transparent"
    }
  ]
}

{% endschema %}
