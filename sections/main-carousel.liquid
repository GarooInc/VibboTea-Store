<!-- TÍTULO -->
    <div class="text-center items-center align-center pt-10 ">
        <h2 class="md:text-5xl text-3xl text-black font-normal font-bricolage ">
            {{ section.settings.section_title | default: "Join the trive" | newline_to_br}}
        </h2>
            <p class="text-black text-[3.5vw] md:text-xl font-bricolage mr-2 md:px-30 py-5 pb-10">
                    {{ section.settings.section_desc }}
                </p>

         {% if section.settings.redireccionamiento %}   
          <div class="bg-[#FFCD51] h-12 inline-flex items-center justify-between rounded-full border border-black pl-4 ">

            <p class="text-black text-[3.5vw] md:text-xl font-bricolage flex-1 text-left px-2">
              {{ section.settings.text_button }}
            </p>

            <a href="/collections/frontpage"
              class="hover:opacity-70 transition-opacity scale-75 md:scale-95 pr-1"
              aria-label="Ir a la colección principal">
              {%- render 'arrow' -%}
            </a>
          </div>
        {% endif %}
    </div>

    {% if section.settings.collection != blank %}
      {% assign coll = collections[section.settings.collection] %}
    {% else %}
      {% assign coll = collection %}
    {% endif %}

    {% assign products_count = section.settings.limit | default: coll.products_count %}
    

<section
  class="relative w-full  pt-4"
  x-data="carousel({
    autoplay: {{ section.settings.autoplay }},
    interval: {{ section.settings.interval | default: 5000 }},
    count: {{ products_count }}
  })"
  x-init="init()"
  aria-roledescription="carousel"
>
  <!-- Desktop: 3 imágenes visibles -->
  <div class="hidden md:block relative overflow-hidden py-15 ">
    <div id="sliderTrack"
      class="flex transition-transform duration-500 ease-out" 
      :style="`transform: translateX(-${index * 33.33}%)`">
      {% if coll %}
        {% for product in coll.products limit: section.settings.limit %}
          <div class="snap-start shrink-0 w-full md:w-[33%] px-10">
            <a href="{{ product.url }}" class="block w-full">
              {% if product.media.size > 1 %}
                {% assign second_image = product.media[1] %}
                
                <div class="w-full md:h-[30vw] bg-white rounded-2xl overflow-hidden flex items-center justify-center">
                  <img
                    src="{{ second_image | image_url: width: 800 }}"
                    alt="{{ second_image.alt | escape }}"
                    width="{{ second_image.width }}"
                    height="{{ second_image.height }}"
                    loading="lazy"
                    class="w-full h-auto object-cover scale-105 hover:scale-115 transition-transform duration-350"
                  >
                </div>

              {% elsif product.featured_media %}
                <!-- fallback -->
                <div class="w-full md:h-[30vw] bg-white rounded-2xl overflow-hidden flex items-center justify-center">
                  <img
                    src="{{ product.featured_media | image_url: width: 800 }}"
                    alt="{{ product.featured_media.alt | escape }}"
                    width="{{ product.featured_media.width }}"
                    height="{{ product.featured_media.height }}"
                    class="w-full h-auto object-cover"
                  >
                </div>
              {% else %}
                <div class="w-full md:h-[30vw]  rounded-2xl overflow-hidden bg-gray-200" ></div>
              {% endif %}

              

              <div class="mt-4">
                <p class="font-bricolage text-2xl md:text-[1.1vw] text-left text-[#575757] font-medium pt-4">
                  {{ product.title }}
                </p>
                <p class="font-bricolage text-2xl md:text-3xl  md:pt-1 text-left text-black font-medium">
                  {{ product.price | money }}
                </p>
              </div>
            </a>

            <form method="post" action="{{ routes.cart_add_url }}" class="md:pt-5 md:text-center mx-auto">
              <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">

              <button 
                type="submit" 
                class="md:bg-black flex items-center justify-center w-full rounded-3xl py-3 md:mt-4 
                      hover:opacity-70 transition-opacity cursor-pointer"
              >
                <span class="font-bricolage md:text-[0.9vw]
                   text-white text-xl uppercase font-light md:text-center">
                  {{ section.settings.text_button_add}}
                </span>
              </button>
            </form>

          </div>
        {% endfor %}
      {% endif %}

    </div>

    <!-- Flechas Desktop -->
    <div class="flex items-center justify-between absolute inset-0 px-6 pointer-events-none">
      <button onclick="slidePrev()" class="-translate-x-5 scale-120 pointer-events-auto hover:opacity-70 transition-opacity">
        {% render 'arrow-slidder2' %}
      </button>

      
      

      <button onclick="slideNext()" class="translate-x-5 scale-120 pointer-events-auto hover:opacity-70 transition-opacity">
        {% render 'arrow-slidder' %}
      </button>
    </div>

  </div>

 <!-- Mobile: 1 imagen visible -->
<div class="md:hidden relative ">
  <!-- Contenedor del carrusel -->
  <div class="relative overflow-hidden h-[630px] ">
      <div id="sliderTrackMobile"
       class="flex transition-transform duration-1000 ease-out "
       :style="`transform: translateX(-${index * 100}%)`" >
      {% if coll %}
        {% for product in coll.products limit: section.settings.limit %}
          <div class="snap-start shrink-0 w-full">
            <a href="{{ product.url }}" class="block px-4 w-full">
              {% if product.media.size > 1 %}
                {% assign second_image = product.media[1] %}
                
                <div class="w-full h-[100vw] rounded-2xl overflow-hidden flex items-center justify-center bg-white">
                  <img
                    src="{{ second_image | image_url: width: 800 }}"
                    alt="{{ second_image.alt | escape }}"
                    width="{{ second_image.width }}"
                    height="{{ second_image.height }}"
                    loading="lazy"
                    class="w-full h-auto object-cover scale-105 hover:scale-115 transition-transform duration-350"
                  >
                </div>
              {% elsif product.featured_media %}
                <div class="w-full h-[100vw] rounded-2xl overflow-hidden flex items-center justify-center bg-white">
                  <img
                    src="{{ product.featured_media | image_url: width: 800 }}"
                    alt="{{ product.featured_media.alt | escape }}"
                    width="{{ product.featured_media.width }}"
                    height="{{ product.featured_media.height }}"
                    loading="lazy"
                    class="w-full h-auto object-cover rounded-2xl hover:scale-105 transition-transform duration-300"
                  >
                </div>
              {% else %}
                <div class="w-full rounded-2xl overflow-hidden h-[100vw] bg-gray-200" ></div>
              {% endif %}

              <div class="mt-4">
                <p class="font-bricolage text-lg md:text-[1.1vw] text-left text-[#575757] font-medium pt-4">{{ product.title }}</p>
                <p class="font-bricolage text-3xl text-left text-black font-medium">{{ product.price | money }}</p>
              </div>

            </a>
            <form method="post" action="/cart/add" class="w-full pt-5 px-4 text-center mx-auto ">
              <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
              <button type="submit" class="bg-black flex items-center justify-center w-full
                 rounded-3xl py-3 md:mt-4 ">
                <span class="font-bricolage text-white text-sm uppercase font-light text-center">Add to cart</span>
              </button>
            </form>
          </div>
        {% endfor %}
      {% endif %}
        </div>
      </div>



  <!-- Flechas Mobile -->
  <div class="absolute inset-0 flex items-center justify-between pointer-events-none">
    <button onclick="slidePrevMobile()" class="-translate-y-20 pointer-events-auto">
      {% render 'arrow-slidder2' %}
    </button>

    <button onclick="slideNextMobile()" class="-translate-y-20 pointer-events-auto">
      {% render 'arrow-slidder' %}
    </button>
  </div>

</div>

  
</section>


<script>
  let currentSlide = 0;
  let autoplayTimer = null;

  function getMaxIndex() {
    const track = document.getElementById("sliderTrack");
    if (!track) return 0;
    const slides = track.children.length;
    return Math.max(slides - 3, 0); // 3 visibles
  }

  function updateSlide() {
    const track = document.getElementById("sliderTrack");
    if (!track) return;
    track.style.transform = `translateX(-${currentSlide * 33.33}%)`;
  }

  function slideNext() {
    const maxIndex = getMaxIndex();
    currentSlide = currentSlide >= maxIndex ? 0 : currentSlide + 1;
    updateSlide();
  }

  function slidePrev() {
    const maxIndex = getMaxIndex();
    currentSlide = currentSlide <= 0 ? maxIndex : currentSlide - 1;
    updateSlide();
  }

  function startAutoplay(interval) {
    stopAutoplay();
    autoplayTimer = setInterval(slideNext, interval);
  }

  function stopAutoplay() {
    if (autoplayTimer) clearInterval(autoplayTimer);
  }

  document.addEventListener("DOMContentLoaded", () => {
    {% if section.settings.autoplay %}
      startAutoplay({{ section.settings.interval | default: 5000 }});
    {% endif %}
  });


</script>

<script>
  let currentSlideMobile = 0;
  let autoplayTimerMobile = null;

  function getMaxIndexMobile() {
    const track = document.getElementById("sliderTrackMobile");
    if (!track) return 0;
    return Math.max(track.children.length - 1, 0);
  }

  function updateSlideMobile() {
    const track = document.getElementById("sliderTrackMobile");
    if (!track) return;
    track.style.transform = `translateX(-${currentSlideMobile * 100}%)`;
  }

  function slideNextMobile() {
    const maxIndex = getMaxIndexMobile();
    currentSlideMobile =
      currentSlideMobile >= maxIndex ? 0 : currentSlideMobile + 1;
    updateSlideMobile();
  }

  function slidePrevMobile() {
    const maxIndex = getMaxIndexMobile();
    currentSlideMobile =
      currentSlideMobile <= 0 ? maxIndex : currentSlideMobile - 1;
    updateSlideMobile();
  }

  function startAutoplayMobile(interval) {
    stopAutoplayMobile();
    autoplayTimerMobile = setInterval(slideNextMobile, interval);
  }

  function stopAutoplayMobile() {
    if (autoplayTimerMobile) clearInterval(autoplayTimerMobile);
  }

  document.addEventListener("DOMContentLoaded", () => {
    {% if section.settings.autoplay %}
      startAutoplayMobile({{ section.settings.interval | default: 5000 }});
    {% endif %}
  });
</script>


{% schema %}
{
  "name": "Slider Productos",
  "settings": [
     {
      "type": "textarea",
      "id": "section_title",
      "label": "Title",
      "default": "Productos Destacados"
    },
    {
      "type": "textarea",
      "id": "section_desc",
      "label": "Descripcion",
      "default": "Productos Destacados"
    },
    {
      "type": "textarea",
      "id": "text_button",
      "label": "Texto de redireccionamiento",
      "default": "I want to feel human again"
    },

    {
      "type": "textarea",
      "id": "text_button_add",
      "label": "Texto de boton",
      "default": "Add to cart"
    },
    {
      "type": "checkbox",
      "id": "redireccionamiento",
      "label": "Redireccionamiento",
      "default": false
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Colección",
    },
    {
      "type": "number",
      "id": "limit",
      "label": "Número máximo de productos",
      "default": 12
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay",
      "default": true
    },
    {
      "type": "range",
      "id": "interval",
      "label": "Intervalo (ms)",
      "min": 2000,
      "max": 9500,
      "step": 500,
      "default": 5000
    }
  ],
  
  "presets": [
    {
      "name": "Carousel de productos", 
        "category": "Productos"

    }
  ]
}
{% endschema %}